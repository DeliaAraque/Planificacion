<div class="row">
	<div class="col-lg-12">
		<h1 class="page-header">Nueva estructura</h1>
	</div>
</div>

<div class="row">
	<div class="col-lg-12">
		<form name="estructura" method="POST" action="moduloPlanificacion/Carrera/Estructura/guardar.php" data-exe="embem('moduloPlanificacion/Carrera/Estructura/index.php', '#page-wrapper')" role="form">
			<div class="form-group">
				<input type="text" name="nombre" placeholder="Nombre" class="form-control" data-type="text" onKeyUp="Verif(this)" required="required" />
				<p class="help-block">Debe indicar el nombre de la estructura, por ejemplo: PNF Trimestral.</p>
			</div>

			<br/><h3>Periodos</h3><br/>

			<div class="row">
				<div class="form-group col-xs-8">
					<input type="text" name="nombrePeriodo0" placeholder="Nombre" class="form-control nombrePeriodo" data-type="[a-zA-Z\\sñÑáÁéÉíÍóÓúÚ\\d]" required="required" />
					<p class="help-block">Debe indicar el nombre del periodo, por ejemplo: Trayecto 1.</p>
				</div>

				<div class="form-group col-xs-4">
					<input type="text" name="idPeriodo0" placeholder="Identificador" class="form-control idPeriodo" data-type="[a-zA-ZñÑáÁéÉíÍóÓúÚ\\d]" required="required" />
					<p class="help-block">Debe ingresar algún identificador para el periodo, por ejemplo: T1.</p>
				</div>

				<div class="col-xs-offset-1 col-xs-11">
					<div class="checkbox"><label><input type="checkbox" onClick="subperiodos(this)"> Subperiodos</label></div>

					<div class="form-group">
						<div class="input-group">
							<input type="text" name="duracionPeriodo0" placeholder="Duración" class="form-control duracionPeriodo" data-type="num" required="required" />
							<span class="input-group-addon" title="Meses"><i class="fa fa-calendar fa-fw"></i></span>
						</div>
					</div>

					<div class="row"></div>
				</div>
			</div>

			<div class="row">
				<div class="form-group col-xs-12"><i class="fa fa-plus fa-fw agregar" title="Nuevo periodo" onClick="nuevoPeriodo(this)"></i></div>
			</div>

			<input type="hidden" name="cantidad" value="0" />

			<div class="form-group text-center">
				<input type="submit" value="Guardar" class="btn btn-lg btn-primary" />
				<input type="button" value="Regresar" class="btn btn-lg" onClick="embem('moduloPlanificacion/Carrera/Estructura/index.php', '#page-wrapper')" />
			</div>
		</form>
	</div>
</div>

<script>
	function subperiodos(obj) {
		var duracion = obj.parentNode.parentNode.parentNode.querySelector(".form-group");
		var duracionInput = duracion.querySelector("input");
		var subperiodos = obj.parentNode.parentNode.parentNode.querySelector(".row");

		if(obj.checked) {
			duracion.style.display = "none";
			duracionInput.value = "null";

			var nameNom = obj.parentNode.parentNode.parentNode.parentNode.querySelector(".nombrePeriodo").name + "Sub[]";
			var nameId = obj.parentNode.parentNode.parentNode.parentNode.querySelector(".idPeriodo").name + "Sub[]";
			var nameDuracion = obj.parentNode.parentNode.parentNode.parentNode.querySelector(".duracionPeriodo").name + "Sub[]";

			subperiodos.innerHTML = "<div class=\"form-group col-xs-8\"> <input type=\"text\" name=\"" + nameNom + "\" placeholder=\"Nombre\" class=\"form-control\" data-type=\"[a-zA-Z\\sñÑáÁéÉíÍóÓúÚ\\d]\" required=\"required\" /> <p class=\"help-block\">Debe indicar el nombre del subperiodo, por ejemplo: Trimestre 1.</p> </div> <div class=\"form-group col-xs-4\"> <input type=\"text\" name=\"" + nameId + "\" placeholder=\"Identificador\" class=\"form-control\" data-type=\"[a-zA-ZñÑáÁéÉíÍóÓúÚ\\d]\" required=\"required\" /> <p class=\"help-block\">Debe ingresar algún identificador para el subperiodo, por ejemplo: t1.</p> </div> <div class=\"form-group col-xs-12\"> <div class=\"input-group\"> <input type=\"text\" name=\"" + nameDuracion + "\" placeholder=\"Duración\" class=\"form-control\" data-type=\"num\" required=\"required\" /> <span class=\"input-group-addon\" title=\"Meses\"><i class=\"fa fa-calendar fa-fw\"></i></span> </div> </div> <div class=\"col-xs-12\"><i class=\"fa fa-plus fa-fw agregar\" title=\"Nuevo subperiodo\" onClick=\"nuevoSubperiodo(this.parentNode)\"></i></div>";
		}

		else {
			subperiodos.innerHTML = "";

			duracion.style.display = "block";
			duracionInput.value = "";
		}
	}

	function nuevoSubperiodo(obj) {
		var subP = document.createElement("div");

		var nameNom = obj.parentNode.parentNode.parentNode.parentNode.querySelector(".nombrePeriodo").name + "Sub[]";
		var nameId = obj.parentNode.parentNode.parentNode.parentNode.querySelector(".idPeriodo").name + "Sub[]";
		var nameDuracion = obj.parentNode.parentNode.parentNode.parentNode.querySelector(".duracionPeriodo").name + "Sub[]";

		subP.innerHTML = "<div> <div class=\"form-group col-xs-12\"><hr/></div> <div class=\"form-group col-xs-7\"> <input type=\"text\" name=\"" + nameNom + "\" placeholder=\"Nombre\" class=\"form-control\" data-type=\"[a-zA-Z\\sñÑáÁéÉíÍóÓúÚ\\d]\" required=\"required\" /> <p class=\"help-block\">Debe indicar el nombre del subperiodo, por ejemplo: Trimestre 1.</p> </div> <div class=\"form-group col-xs-4\"> <input type=\"text\" name=\"" + nameId + "\" placeholder=\"Identificador\" class=\"form-control\" data-type=\"[a-zA-ZñÑáÁéÉíÍóÓúÚ\\d]\" required=\"required\" /> <p class=\"help-block\">Debe ingresar algún identificador para el subperiodo, por ejemplo: t1.</p> </div> <div class=\"form-group col-xs-1\"><i class=\"fa fa-trash-o fa-fw eliminar\" title=\"Eliminar subperiodo\" onClick=\"this.parentNode.parentNode.parentNode.removeChild(this.parentNode.parentNode)\"></i></div> <div class=\"form-group col-xs-12\"> <div class=\"input-group\"> <input type=\"text\" name=\"" + nameDuracion + "\" placeholder=\"Duración\" class=\"form-control\" data-type=\"num\" required=\"required\" /> <span class=\"input-group-addon\" title=\"Meses\"><i class=\"fa fa-calendar fa-fw\"></i></span> </div> </div> </div>";

		obj.parentNode.insertBefore(subP, obj);
	}

	function nuevoPeriodo(obj) {
		var cantidad = document.estructura.cantidad;
		cantidad.value = parseInt(cantidad.value) + 1;

		var periodo = document.createElement("div");

		var nameNom = "nombrePeriodo" + cantidad.value;
		var nameId = "idPeriodo" + cantidad.value;
		var nameDuracion = "duracionPeriodo" + cantidad.value;

		periodo.innerHTML = "<div class=\"row\"> <div class=\"form-group col-xs-12\"><hr/></div> <div class=\"form-group col-xs-7\"> <input type=\"text\" name=\"" + nameNom + "\" placeholder=\"Nombre\" class=\"form-control nombrePeriodo\" data-type=\"[a-zA-Z\\sñÑáÁéÉíÍóÓúÚ\\d]\" required=\"required\" /> <p class=\"help-block\">Debe indicar el nombre del periodo, por ejemplo: Trayecto 1.</p> </div> <div class=\"form-group col-xs-4\"> <input type=\"text\" name=\"" + nameId + "\" placeholder=\"Identificador\" class=\"form-control idPeriodo\" data-type=\"[a-zA-ZñÑáÁéÉíÍóÓúÚ\\d]\" required=\"required\" /> <p class=\"help-block\">Debe ingresar algún identificador para el periodo, por ejemplo: T1.</p> </div> <div class=\"form-group col-xs-1\"><i class=\"fa fa-trash-o fa-fw eliminar\" title=\"Eliminar periodo\" onClick=\"this.parentNode.parentNode.parentNode.parentNode.removeChild(this.parentNode.parentNode.parentNode)\"></i></div> <div class=\"col-xs-offset-1 col-xs-11\"> <div class=\"checkbox\"><label><input type=\"checkbox\" onClick=\"subperiodos(this)\"> Subperiodos</label></div> <div class=\"form-group\"> <div class=\"input-group\"> <input type=\"text\" name=\"" + nameDuracion + "\" placeholder=\"Duración\" class=\"form-control duracionPeriodo\" data-type=\"num\" required=\"required\" /> <span class=\"input-group-addon\" title=\"Meses\"><i class=\"fa fa-calendar fa-fw\"></i></span> </div> </div> <div class=\"row\"></div> </div> </div>";

		obj.parentNode.insertBefore(periodo, obj);
	}
</script>